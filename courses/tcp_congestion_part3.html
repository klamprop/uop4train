<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="PlanetLab course">
    <meta name="author" content="FORGE">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <title>TCP Congestion Control test Part3</title>

    <!-- Bootstrap core CSS -->
        <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">


  </head>


<body>
<div class="container">
<h1>Part 3. Create your own TCP congestion control experiment.</h1>
<h2>Description</h2>
In this part of the exercise the students will independently setup from scratch their own TCP congestion control exercise. They will have the opportunity to use the FIRE tools and facilities in order to perform the following tasks.
<ul>
<li>Reserve the necessary resources for the exercise (hosts, links, routers etc).</li>
<li>Create the required topology.</li>
<li>Connect to the hosts of this topology and ensure that everything works as requested.</li>
<li>Download and install all the necessary software. No scripts are allowed!</li>
<li>Configure all the necessary software, prepare the hosts for the exercise (e.g. start monitoring processes)</li>
<li>Run the experiment.</li>
<li>Collect the results.</li>
<li>"Clean everything" - release the resources, remove unnecessary software, files etc.</li>
</ul>
<br />
<h2>Objectives</h2>
This part uses a simple TCP congestion control exercise to train the students on how to create and manage live testbeds. Such training includes actions like reserving FIRE resources, installing OS and tools, configuring software, creating specific network topologies, evaluate the tool’s functionality etc. During this part the users will:
<ul>
<li>familiarize themselves with the tools and infrastructure provided by FIRE, for this assignment.</li>
<li>setup the required network topologies described in the assignment.</li>
<li>generate the required network traffic among the nodes described in the assignment. Students must make sure that they can create the necessary network conditions for the exercise (e.g. create bottlenecks, create large delays, open or close flows etc.).</li>
<li>identify, download and install all the required tools and software, necessary for creating this exercise.</li>
</ul>
<h2>Tools - infrastructure - software - technologies</h2>
For this part of the exercise students will use resources from the Virtual Wall, w-iLab.t (<a href = https://www.wall2.ilabt.iminds.be/>https://www.wall2.ilabt.iminds.be</a>) of the iMinds (<a href = http://www.iminds.be/en/>http://www.iminds.be/en</a>).  Each test (experiment created by one user) will require the use of 3 nodes. 
<br />The topology creation and management will be performed using the iMinds w-iLab.t website and its web tools e.g. the GUI editor for creating topologies, the Traffic shaping tool for handling the traffic between nodes of the experiment etc. Thus the students will have the ability to setup the topology of their experiment using a web browser. All the nodes of the experiment will use Ubuntu OS. Once the experiment is live (nodes are reserved and running), the students must use the ssh tool (secure shell), connect to all of the Virtual Wall nodes and perform an initial check (e.g. if all network interfaces are correctly configured, if links are working etc). Finally, students must have installed in their computer a software for the graphical representation of the results. This tool can be the gnuplot*.
<br />Once the students connect to the nodes, they will need to install the iperf tool to be able to run the TCP congestion control experiment. 
<ul><li>iperf: Iperf is a tool to measure maximum TCP bandwidth, allowing the tuning of various parameters and UDP characteristics. Iperf reports bandwidth, delay jitter, datagram loss. must be installed in both end hosts*.</li></ul>

<small><strong>*Students can download and install software in Ubuntu OS using the following command.<br />
	<ul><li>sudo apt-get install 'software-name'</li></ul></strong></small>
<h2>Exercise</h2>
<ol>
<h3>Part 1 - Introduction to the Virtual Wall</h3>
<li>If you do not have an account in iMinds Virtual Wall go to <a href = https://www.wall2.ilabt.iminds.be/>https://www.wall2.ilabt.iminds.be</a>  and create a new one. (instructions can be found here: <a href = http://doc.fed4fire.eu/getanaccount.html>http://doc.fed4fire.eu/getanaccount.html </a>). Using your account log in the iMinds Virtual wall and go to your profile page.</li>
<iframe width="560" height="315" src="http://www.youtube.com/embed/VbfVtG128DY?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>
<h3>Part 2 - Experiment Setup</h3>
<li>In the menu "Experimentation" (page header) click the link "Begin an Experiment". You will be redirected to a new page with various options. Click the "New Gui Editor". Using the graphical interface create the topology you see in figure 1. Name one of the nodes "client" and the other "server". Choose for both the nodes (hosts P1, P2) the operating system Ubuntu. The IP addresses and link capacity should be left as default. (Make sure that the two hosts are connected with a link). Save the experiment using any name you wish e.g. myfirstexperiment.</li>
<img border="1" src="tcp_congestion.jpg"></img>
<br />Figure 1<br />
<br />
<iframe width="560" height="315" src="http://www.youtube.com/embed/PKlMRAm94p8?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>
<li>From your experiment's list ("My Emulab" > tab: "Experiments"),  click on the name of your experiment and go to the experiment management page. From the left menu, click on the link "Swap experiment in" to activate it.</li>
<iframe width="560" height="315" src="http://www.youtube.com/embed/iJe2EP66HCU?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>
<li>If your computer supports IPv6 use the ssh tool and connect to the nodes P1 and P2 (Run a ping between them to make sure that the link between them is working ok). If your computer does not support IPv6, setup a tunnel using openvpn, for IPv4 access. Using the "Modify traffic shaping", try to modify the packet delay between the client and the server.</li>
<iframe width="560" height="315" src="http://www.youtube.com/embed/WJB3unplTmc?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>
<iframe width="560" height="315" src="http://www.youtube.com/embed/o-01BG4QAoA?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>
<h3>Part3 - TCP congestion control experiment.</h3>
<li>Download to both hosts P1, P2 (client, server) the iperf software.</li>
	<strong>iperf - sudo apt-get install iperf</strong><br />
<iframe width="560" height="315" src="http://www.youtube.com/embed/ohBdSuzQ1Is?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>

<li>Insert tcp_probe module (as root) on sending machine (client) and filter for iperf port.</li>
	<strong>insmod /lib/modules/x.x.x(kernel_version)/kernel/net/ipv4/tcp_probe_fixed.ko port=5001 full=1</strong><br />

<li>Capture tcp probe output (on sender) and place in background</li>
	<strong>cat /proc/net/tcpprobe >  tcpout &</strong><br />
<iframe width="560" height="315" src="http://www.youtube.com/embed/mxIUF0P_7yY?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>

<li>Start iperf server on the receiver_host (server)</li>
	<strong>iperf -s</strong><br /> 

<li>Run iperf test on sender_host (client) for 300 seconds with a report interval 1 sec. As receiver_host use the IP address of the server node.</li>
	<strong>iperf -i1 -t300 -c (receiver_host) </strong><br />
<iframe width="560" height="315" src="http://www.youtube.com/embed/c5ZTKi1bUmU?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>

<li>After the completion of the experiment, a file with the name "tcpout" should exist in the client node. Download this file in your local computer (e.g. with the use of the sftp tool). Use the gnuplot software to create a graphical representation of the results for cwnd and ssthresh. The command you should run is the following.</li>
	<strong>$ gnuplot -persist <<"EOF"<br />
		set style data linespoints<br />
		show timestamp<br />
		set xlabel "time (seconds)"<br />
		set ylabel "Segments (cwnd, ssthresh)"<br />
		plot "tcpout" using 1:7 title "snd_cwnd", \<br />
		"tcpout" using 1:($8>=2147483647 ? 0 : $8) title "snd_ssthresh"<br />
	EOF</strong><br />
<iframe width="560" height="315" src="http://www.youtube.com/embed/01IOKEvPTqY?list=PLzkRA_WF4rULIXke2noN1wU9dHTKdAccP" frameborder="0" allowfullscreen></iframe>

<li>(Optional *) Remove the tcp_probe module from the kernel and kill the monitoring process.</li>
	<strong>rmmod tcp_probe. <br /> 
	kill pid (pid: process id of monitoring process - cat /proc/net/tcpprobe > tcpout)</strong><br /> 

<li>After completing the experiment, go to the experiment management page (the page you are redirected if you click on the experiment name in your experiment's list ("My Emulab" > tab "Experiments"). In the left menu click on the link "Swap experiment out". This action will release all the resources that were reserved in the iMinds Virtual Wall for your experiment.</li>
<li>From the same menu in the experiment management page, click on the link "Terminate Experiment" to delete your experiment.</li>
</ol>
<strong><small>*This is an optional step because when we swap an experiment out, Virtual Wall does not save the modifications made in the Operating System of the nodes of the experiment. Each time an experiment is swapped in, the Virtual Wall loads to its nodes the predefined Operating System (in our case Ubuntu OS). This also means that iperf will not be installed in the client and server nodes, if we swap this experiment in again in the future.</small></strong>


</div>
</body>
</html>
